<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SSD Attendance</title>

<style>
body{
  font-family:'Poppins',sans-serif;
  background:#000080;
  color:white;
  display:flex;
  justify-content:center;
  align-items:flex-start;
  padding:16px;
  min-height:100vh;
}
.container{
  background:#000022;
  padding:20px;
  border-radius:10px;
  border:2px solid red;
  width:100%;
  max-width:600px;
  text-align:center;
}
h2{color:#ff0000;}

input,button{
  padding:8px;
  margin:5px 0;
  border-radius:5px;
  border:none;
  outline:none;
}
input[type=text],input[type=time]{width:100%;}

button{
  cursor:pointer;
  background:#111;
  color:white;
  font-weight:600;
}
button:hover{opacity:.9}

.hidden{display:none;}

#logo{
  width:120px;height:120px;
  border-radius:50%;
  margin-bottom:10px;
  border:2px solid red;
}

/* ROLE BUTTON STYLE */
.roleBtn{
  display:flex;
  align-items:center;
  gap:8px;
  padding:6px 10px;
  border:1px solid #fff;
  background:#000;
  color:#fff;
  min-width:170px;
}
.roleBox{
  width:14px;
  height:14px;
  border:2px solid #fff;
}
.roleBtn.active{
  border-color:#00ff88;
}
.roleBtn.active .roleBox{
  background:#00ff88;
}

/* TABLE */
table{width:100%;border-collapse:collapse;margin-top:10px;}
th,td{border:1px solid #fff;padding:6px;}
th{background:#222;}
</style>
</head>

<body>

<div class="container">

<img id="logo" src="https://i.postimg.cc/7YKMkCFf/file-000000004aa471fa98fe9bf6b8d84453.png">

<!-- MEMBER FORM -->
<div id="memberForm">
<h2>SSD ATTENDANCE FORM</h2>

<form id="attendanceForm">

<label>NAME:</label>
<input type="text" id="nameInput" required>

<label>IGN CPM:</label>
<input type="text" id="ignInput" required>

<label>ID CPM:</label>
<input type="text" id="cpmIdInput" required>

<label>ROLES:</label>

<div style="display:flex;flex-direction:column;gap:6px;margin:10px 0;align-items:flex-start;">

<button type="button" class="roleBtn" data-role="Owner">
  <div class="roleBox"></div> Owner
</button>
<button type="button" class="roleBtn" data-role="Co owner">
  <div class="roleBox"></div> Co owner
</button>
<button type="button" class="roleBtn" data-role="President">
  <div class="roleBox"></div> President
</button>
<button type="button" class="roleBtn" data-role="Vice president">
  <div class="roleBox"></div> Vice president
</button>
<button type="button" class="roleBtn" data-role="Admin">
  <div class="roleBox"></div> Admin
</button>
<button type="button" class="roleBtn" data-role="Members">
  <div class="roleBox"></div> Members
</button>

</div>

<!-- hidden checkboxes -->
<div class="hidden" id="roleCheckboxes">
  <input type="checkbox" name="roles" value="Owner">
  <input type="checkbox" name="roles" value="Co owner">
  <input type="checkbox" name="roles" value="President">
  <input type="checkbox" name="roles" value="Vice president">
  <input type="checkbox" name="roles" value="Admin">
  <input type="checkbox" name="roles" value="Members">
</div>

<button type="submit">SUBMIT FORM</button>
</form>

<button id="adminLoginBtn">Admin Login</button>
</div>

<!-- ADMIN DASHBOARD -->
<div id="adminDashboard" class="hidden">
<h2>Admin Dashboard</h2>

<label>Reset Time:
<input type="time" id="resetTimeInput">
</label>
<button id="setTimeBtn">Set Time</button>

<div style="margin-top:10px;">
<button id="resetBtn">Reset Attendance Members</button>
<button id="downloadBtn">Download Attendance CSV</button>
</div>

<table>
<thead>
<tr>
<th>No</th><th>Name</th><th>IGN</th><th>ID</th><th>Roles</th>
</tr>
</thead>
<tbody id="adminTable"></tbody>
</table>

<button id="logoutBtn">Logout Admin</button>
</div>

</div>

<script>
// ---------- DATA ----------
let attendanceData = JSON.parse(localStorage.getItem('ssdAttendance')) || [];
let resetTime = localStorage.getItem('ssdResetTime') || null;

// ---------- ROLE BUTTONS ----------
const roleBtns = document.querySelectorAll('.roleBtn');
const roleCheckboxes = document.querySelectorAll('#roleCheckboxes input');

roleBtns.forEach(btn=>{
  btn.addEventListener('click',()=>{
    const role = btn.dataset.role;
    const cb = [...roleCheckboxes].find(c=>c.value===role);
    cb.checked = !cb.checked;
    btn.classList.toggle('active', cb.checked);
  });
});

// ---------- SUBMIT FORM ----------
attendanceForm.addEventListener('submit',e=>{
  e.preventDefault();

  const roles = [...roleCheckboxes]
    .filter(c=>c.checked)
    .map(c=>c.value)
    .join(', ');

  attendanceData.push({
    name:nameInput.value,
    ign:ignInput.value,
    cpmId:cpmIdInput.value,
    roles
  });

  localStorage.setItem('ssdAttendance',JSON.stringify(attendanceData));
  alert('Attendance submitted!');

  e.target.reset();
  roleCheckboxes.forEach(c=>c.checked=false);
  roleBtns.forEach(b=>b.classList.remove('active'));
});

// ---------- ADMIN ----------
adminLoginBtn.onclick=()=>{
  if(prompt('Username:')==='ssdadmin2025' && prompt('Password:')==='Admincpmoi2025'){
    memberForm.classList.add('hidden');
    adminDashboard.classList.remove('hidden');
    renderTable();
  } else alert('Invalid credentials');
};

logoutBtn.onclick=()=>{
  adminDashboard.classList.add('hidden');
  memberForm.classList.remove('hidden');
};

function renderTable(){
  adminTable.innerHTML='';
  attendanceData.forEach((d,i)=>{
    adminTable.innerHTML+=`
    <tr>
      <td>${i+1}</td>
      <td>${d.name}</td>
      <td>${d.ign}</td>
      <td>${d.cpmId}</td>
      <td>${d.roles}</td>
    </tr>`;
  });
}

// ---------- RESET ----------
resetBtn.onclick=()=>{
  if(confirm('Reset all attendance?')){
    attendanceData=[];
    localStorage.setItem('ssdAttendance','[]');
    renderTable();
  }
};

// ---------- DOWNLOAD ----------
downloadBtn.onclick=()=>{
  if(attendanceData.length===0) return alert('No data');
  const csv = attendanceData.map(d=>`${d.name},${d.ign},${d.cpmId},${d.roles}`).join('\n');
  const a=document.createElement('a');
  a.href=URL.createObjectURL(new Blob([csv],{type:'text/csv'}));
  a.download='attendance.csv';
  a.click();
};

// ---------- RESET TIME ----------
if(resetTime) resetTimeInput.value=resetTime;
setTimeBtn.onclick=()=>{
  resetTime=resetTimeInput.value;
  localStorage.setItem('ssdResetTime',resetTime);
  alert('Reset time set');
};

// ---------- AUTO RESET ----------
setInterval(()=>{
  if(!resetTime) return;
  const now=new Date();
  const [h,m]=resetTime.split(':').map(Number);
  if(now.getHours()===h && now.getMinutes()===m){
    attendanceData=[];
    localStorage.setItem('ssdAttendance','[]');
    renderTable();
  }
},60000);
</script>

</body>
</html>
